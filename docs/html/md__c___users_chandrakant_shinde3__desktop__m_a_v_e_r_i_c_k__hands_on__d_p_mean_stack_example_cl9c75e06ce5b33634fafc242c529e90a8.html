<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>end to end lab: @npmcli/git</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">end to end lab
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">@npmcli/git </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >A utility for spawning git from npm CLI contexts.</p>
<p >This is <em>not</em> an implementation of git itself, it's just a thing that spawns child processes to tell the system git CLI implementation to do stuff.</p>
<h1><a class="anchor" id="autotoc_md1297"></a>
USAGE</h1>
<div class="fragment"><div class="line">const git = require(&#39;@npmcli/git&#39;)</div>
<div class="line">git.clone(&#39;git://foo/bar.git&#39;, &#39;some-branch&#39;, &#39;some-path&#39;, opts) // clone a repo</div>
<div class="line">  .then(() =&gt; git.spawn([&#39;checkout&#39;, &#39;some-branch&#39;], {cwd: &#39;bar&#39;}))</div>
<div class="line">  .then(() =&gt; git.spawn([&#39;you get the idea&#39;]))</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1298"></a>
API</h1>
<p >Most methods take an options object. Options are described below.</p>
<h2><a class="anchor" id="autotoc_md1299"></a>
&lt;tt&gt;git.spawn(args, opts = {})&lt;/tt&gt;</h2>
<p >Launch a <code>git</code> subprocess with the arguments specified.</p>
<p >All the other functions call this one at some point.</p>
<p >Processes are launched using <a href="http://npm.im/@npmcli/promise-spawn"><code>@npmcli/promise-spawn</code></a>, with the <code>stdioString: true</code> option enabled by default, since git output is generally in readable string format.</p>
<p >Return value is a <code>Promise</code> that resolves to a result object with <code>{cmd, args, code, signal, stdout, stderr}</code> members, or rejects with an error with the same fields, passed back from <a href="http://npm.im/@npmcli/promise-spawn"><code>@npmcli/promise-spawn</code></a>.</p>
<h2><a class="anchor" id="autotoc_md1300"></a>
‘git.clone(repo, ref = 'HEAD’, target = null, opts = {})&lt;tt&gt;-&gt;&lt;/tt&gt;Promise&lt;sha String&gt;`</h2>
<p >Clone the repository into <code>target</code> path (or the default path for the name of the repository), checking out <code>ref</code>.</p>
<p >Return value is the sha of the current HEAD in the locally cloned repository.</p>
<p >In lieu of a specific <code>ref</code>, you may also pass in a <code>spec</code> option, which is a <a href="http://npm.im/npm-package-arg"><code>npm-package-arg</code></a> object for a <code>git</code> package dependency reference. In this way, you can select SemVer tags within a range, or any git committish value. For example:</p>
<div class="fragment"><div class="line">const npa = require(&#39;npm-package-arg&#39;)</div>
<div class="line">git.clone(&#39;git@github.com:npm/git.git&#39;, &#39;&#39;, null, {</div>
<div class="line">  spec: npa(&#39;github:npm/git#semver:1.x&#39;),</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">// only gitRange and gitCommittish are relevant, so this works, too</div>
<div class="line">git.clone(&#39;git@github.com:npm/git.git&#39;, null, null, {</div>
<div class="line">  spec: { gitRange: &#39;1.x&#39; }</div>
<div class="line">})</div>
</div><!-- fragment --><p >This will automatically do a shallow <code>--depth=1</code> clone on any hosts that are known to support it. To force a shallow or deep clone, you can set the <code>gitShallow</code> option to <code>true</code> or <code>false</code> respectively.</p>
<h2><a class="anchor" id="autotoc_md1301"></a>
&lt;tt&gt;git.revs(repo, opts = {})&lt;/tt&gt; -&gt; &lt;tt&gt;Promise&lt;rev doc Object&gt;&lt;/tt&gt;</h2>
<p >Fetch a representation of all of the named references in a given repository. The resulting doc is intentionally somewhat <a href="https://www.npmjs.com/package/pacote#packuments">packument</a>-like, so that git semver ranges can be applied using the same <a href="http://npm.im/npm-pick-manifest"><code>npm-pick-manifest</code></a> logic.</p>
<p >The resulting object looks like:</p>
<div class="fragment"><div class="line">revs = {</div>
<div class="line">  versions: {</div>
<div class="line">    // all semver-looking tags go in here...</div>
<div class="line">    // version: { sha, ref, rawRef, type }</div>
<div class="line">    &#39;1.0.0&#39;: {</div>
<div class="line">      sha: &#39;1bc5fba3353f8e1b56493b266bc459276ab23139&#39;,</div>
<div class="line">      ref: &#39;v1.0.0&#39;,</div>
<div class="line">      rawRef: &#39;refs/tags/v1.0.0&#39;,</div>
<div class="line">      type: &#39;tag&#39;,</div>
<div class="line">    },</div>
<div class="line">  },</div>
<div class="line">  &#39;dist-tags&#39;: {</div>
<div class="line">    HEAD: &#39;1.0.0&#39;,</div>
<div class="line">    latest: &#39;1.0.0&#39;,</div>
<div class="line">  },</div>
<div class="line">  refs: {</div>
<div class="line">    // all the advertised refs that can be cloned down remotely</div>
<div class="line">    HEAD: { sha, ref, rawRef, type: &#39;head&#39; },</div>
<div class="line">    master: { ... },</div>
<div class="line">    &#39;v1.0.0&#39;: { ... },</div>
<div class="line">    &#39;refs/tags/v1.0.0&#39;: { ... },</div>
<div class="line">  },</div>
<div class="line">  shas: {</div>
<div class="line">    // all named shas referenced above</div>
<div class="line">    // sha: [list, of, refs]</div>
<div class="line">    &#39;6b2501f9183a1753027a9bf89a184b7d3d4602c7&#39;: [</div>
<div class="line">      &#39;HEAD&#39;,</div>
<div class="line">      &#39;master&#39;,</div>
<div class="line">      &#39;refs/heads/master&#39;,</div>
<div class="line">    ],</div>
<div class="line">    &#39;1bc5fba3353f8e1b56493b266bc459276ab23139&#39;: [ &#39;v1.0.0&#39;, &#39;refs/tags/v1.0.0&#39; ],</div>
<div class="line">  },</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1302"></a>
&lt;tt&gt;git.is(opts)&lt;/tt&gt; -&gt; &lt;tt&gt;Promise&lt;Boolean&gt;&lt;/tt&gt;</h2>
<p >Resolve to <code>true</code> if the path argument refers to the root of a git repository.</p>
<p >It does this by looking for a file in <code>${path}/.git/index</code>, which is not an airtight indicator, but at least avoids being fooled by an empty directory or a file named <code>.git</code>.</p>
<h2><a class="anchor" id="autotoc_md1303"></a>
&lt;tt&gt;git.find(opts)&lt;/tt&gt; -&gt; &lt;tt&gt;Promise&lt;String | null&gt;&lt;/tt&gt;</h2>
<p >Given a path, walk up the file system tree until a git repo working directory is found. Since this calls <code>stat</code> a bunch of times, it's probably best to only call it if you're reasonably sure you're likely to be in a git project somewhere.</p>
<p >Resolves to <code>null</code> if not in a git project.</p>
<h2><a class="anchor" id="autotoc_md1304"></a>
&lt;tt&gt;git.isClean(opts = {})&lt;/tt&gt; -&gt; &lt;tt&gt;Promise&lt;Boolean&gt;&lt;/tt&gt;</h2>
<p >Return true if in a git dir, and that git dir is free of changes. This will resolve <code>true</code> if the git working dir is clean, or <code>false</code> if not, and reject if the path is not within a git directory or some other error occurs.</p>
<h1><a class="anchor" id="autotoc_md1305"></a>
OPTIONS</h1>
<ul>
<li><code>retry</code> An object to configure retry behavior for transient network errors with exponential backoff.<ul>
<li><code>retries</code>: Defaults to <code>opts.fetchRetries</code> or 2</li>
<li><code>factor</code>: Defaults to <code>opts.fetchRetryFactor</code> or 10</li>
<li><code>maxTimeout</code>: Defaults to <code>opts.fetchRetryMaxtimeout</code> or 60000</li>
<li><code>minTimeout</code>: Defaults to <code>opts.fetchRetryMintimeout</code> or 1000</li>
</ul>
</li>
<li><code>git</code> Path to the <code>git</code> binary to use. Will look up the first <code>git</code> in the <code>PATH</code> if not specified.</li>
<li><code>spec</code> The <a href="http://npm.im/npm-package-arg"><code>npm-package-arg</code></a> specifier object for the thing being fetched (if relevant).</li>
<li><code>fakePlatform</code> set to a fake value of <code>process.platform</code> to use. (Just for testing <code>win32</code> behavior on Unix, and vice versa.)</li>
<li><code>cwd</code> The current working dir for the git command. Particularly for <code>find</code> and <code>is</code> and <code>isClean</code>, it's good to know that this defaults to <code><a class="el" href="namespaceupdate-gyp.html#a353f325a85a850b0456a7cbaff8fc43b">process.cwd()</a></code>, as one might expect.</li>
<li>Any other options that can be passed to <a href="http://npm.im/@npmcli/promise-spawn"><code>@npmcli/promise-spawn</code></a>, or <code>child_process.spawn()</code>. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
