<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>end to end lab: @npmcli/run-script</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">end to end lab
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">@npmcli/run-script </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >Run a lifecycle script for a package (descendant of npm-lifecycle)</p>
<h1><a class="anchor" id="autotoc_md1330"></a>
USAGE</h1>
<div class="fragment"><div class="line">const runScript = require(&#39;@npmcli/run-script&#39;)</div>
<div class="line"> </div>
<div class="line">runScript({</div>
<div class="line">  // required, the script to run</div>
<div class="line">  event: &#39;install&#39;,</div>
<div class="line"> </div>
<div class="line">  // extra args to pass to the command, defaults to []</div>
<div class="line">  args: [],</div>
<div class="line"> </div>
<div class="line">  // required, the folder where the package lives</div>
<div class="line">  path: &#39;/path/to/package/folder&#39;,</div>
<div class="line"> </div>
<div class="line">  // optional, defaults to /bin/sh on unix, or cmd.exe on windows</div>
<div class="line">  scriptShell: &#39;/bin/bash&#39;,</div>
<div class="line"> </div>
<div class="line">  // optional, defaults to false</div>
<div class="line">  // return stdout and stderr as strings rather than buffers</div>
<div class="line">  stdioString: true,</div>
<div class="line"> </div>
<div class="line">  // optional, additional environment variables to add</div>
<div class="line">  // note that process.env IS inherited by default</div>
<div class="line">  // Always set:</div>
<div class="line">  // - npm_package_json The package.json file in the folder</div>
<div class="line">  // - npm_lifecycle_event The event that this is being run for</div>
<div class="line">  // - npm_lifecycle_script The script being run</div>
<div class="line">  // The fields described in https://github.com/npm/rfcs/pull/183</div>
<div class="line">  env: {</div>
<div class="line">    npm_package_from: &#39;foo@bar&#39;,</div>
<div class="line">    npm_package_resolved: &#39;https://registry.npmjs.org/foo/-/foo-1.2.3.tgz&#39;,</div>
<div class="line">    npm_package_integrity: &#39;sha512-foobarbaz&#39;,</div>
<div class="line">  },</div>
<div class="line"> </div>
<div class="line">  // defaults to &#39;pipe&#39;.  Can also pass an array like you would to node&#39;s</div>
<div class="line">  // exec or spawn functions.  Note that if it&#39;s anything other than</div>
<div class="line">  // &#39;pipe&#39; then the stdout/stderr values on the result will be missing.</div>
<div class="line">  // npm cli sets this to &#39;inherit&#39; for explicit run-scripts (test, etc.)</div>
<div class="line">  // but leaves it as &#39;pipe&#39; for install scripts that run in parallel.</div>
<div class="line">  stdio: &#39;inherit&#39;,</div>
<div class="line"> </div>
<div class="line">  // print the package id and script, and the command to be run, like:</div>
<div class="line">  // &gt; somepackage@1.2.3 postinstall</div>
<div class="line">  // &gt; make all-the-things</div>
<div class="line">  // Defaults true when stdio:&#39;inherit&#39;, otherwise suppressed</div>
<div class="line">  banner: true,</div>
<div class="line">})</div>
<div class="line">  .then(({ code, signal, stdout, stderr, pkgid, path, event, script }) =&gt; {</div>
<div class="line">    // do something with the results</div>
<div class="line">  })</div>
<div class="line">  .catch(er =&gt; {</div>
<div class="line">    // command did not work.</div>
<div class="line">    // er is decorated with:</div>
<div class="line">    // - code</div>
<div class="line">    // - signal</div>
<div class="line">    // - stdout</div>
<div class="line">    // - stderr</div>
<div class="line">    // - path</div>
<div class="line">    // - pkgid (name@version string)</div>
<div class="line">    // - event</div>
<div class="line">    // - script</div>
<div class="line">  })</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1331"></a>
API</h1>
<p >Call the exported <code>runScript</code> function with an options object.</p>
<p >Returns a promise that resolves to the result of the execution. Promise rejects if the execution fails (exits non-zero) or has any other error. Rejected errors are decorated with the same values as the result object.</p>
<p >If the stdio options mean that it'll have a piped stdin, then the stdin is ended immediately on the child process. If stdin is shared with the parent terminal, then it is up to the user to end it, of course.</p>
<h2><a class="anchor" id="autotoc_md1332"></a>
Results</h2>
<ul>
<li><code>code</code> Process exit code</li>
<li><code>signal</code> Process exit signal</li>
<li><code>stdout</code> stdout data (Buffer, or String when <code>stdioString</code> set to true)</li>
<li><code>stderr</code> stderr data (Buffer, or String when <code>stdioString</code> set to true)</li>
<li><code>path</code> Path to the package executing its script</li>
<li><code>event</code> Lifecycle event being run</li>
<li><code>script</code> Command being run</li>
</ul>
<h2><a class="anchor" id="autotoc_md1333"></a>
Options</h2>
<ul>
<li><code>path</code> Required. The path to the package having its script run.</li>
<li><code>event</code> Required. The event being executed.</li>
<li><code>args</code> Optional, default <code>[]</code>. Extra arguments to pass to the script.</li>
<li><code>env</code> Optional, object of fields to add to the environment of the subprocess. Note that process.env IS inherited by default These are always set:<ul>
<li><code>npm_package_json</code> The package.json file in the folder</li>
<li><code>npm_lifecycle_event</code> The event that this is being run for</li>
<li><code>npm_lifecycle_script</code> The script being run</li>
<li>The <code>package.json</code> fields described in <a href="https://github.com/npm/rfcs/pull/183/files">RFC183</a>.</li>
</ul>
</li>
<li><code>scriptShell</code> Optional, defaults to <code>/bin/sh</code> on Unix, defaults to <code>env.ComSpec</code> or <code>cmd</code> on Windows. Custom script to use to execute the command.</li>
<li><code>stdio</code> Optional, defaults to &lsquo;'pipe&rsquo;<code>. The same as the</code>stdio<code>argument passed to</code>child_process<code>functions in Node.js. Note that if a stdio output is set to anything other than</code>pipe`, it will not be present in the result/error object.</li>
<li><code>cmd</code> Optional. Override the script from the <code>package.json</code> with something else, which will be run in an otherwise matching environment.</li>
<li><code>stdioString</code> Optional, defaults to <code>false</code>. Return string values for <code>stderr</code> and <code>stdout</code> rather than Buffers.</li>
<li><code>banner</code> Optional, defaults to <code>true</code>. If the <code>stdio</code> option is set to &lsquo;'inherit&rsquo;<code>, then print a banner with the package name and version, event name, and script command to be run. Set explicitly to</code>false` to disable for inherited stdio.</li>
</ul>
<p >Note that this does <em>not</em> run pre-event and post-event scripts. The caller has to manage that process themselves.</p>
<h1><a class="anchor" id="autotoc_md1334"></a>
Differences from &lt;a href="https://github.com/npm/npm-lifecycle" &gt;npm-lifecycle&lt;/a&gt;</h1>
<p >This is an implementation to satisfy <a href="https://github.com/npm/rfcs/pull/90">RFC 90</a>, <a href="https://github.com/npm/rfcs/pull/77">RFC 77</a>, and <a href="https://github.com/npm/rfcs/pull/73">RFC 73</a>.</p>
<p >Apart from those behavior changes in npm v7, this is also just refresh of the codebase, with modern coding techniques and better test coverage.</p>
<p >Functionally, this means:</p>
<ul>
<li>Output is not dumped to the top level process's stdio by default.</li>
<li>Less stuff is put into the environment.</li>
<li>It is not opinionated about logging. (So, at least with the logging framework in npm v7.0 and before, the caller has to call <code>log.disableProgress()</code> and <code>log.enableProgress()</code> at the appropriate times, if necessary.)</li>
<li>The directory containing the <code>node</code> executable is <em>never</em> added to the <code>PATH</code> environment variable. (Ie, <code>--scripts-prepend-node-path</code> is effectively always set to <code>false</code>.) Doing so causes more unintended side effects than it ever prevented.</li>
<li>Hook scripts are not run by this module. If the caller wishes to run hook scripts, then they can override the default package script with an explicit <code>cmd</code> option pointing to the <code>node_modules/.hook/${event}</code> script. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
